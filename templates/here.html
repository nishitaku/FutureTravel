{% extends "layout.html" %}
{% block content %}

<!-- ヘッダー -->
{% from "common.html" import header %}
{{ header('現在地から探す') }}

<div class="form">
    <div class="container">
        <h3>現在地の近くのスポット</h3>
        <p><button onclick="getMyPlace()">現在位置を取得</button></p>
        <div id="result"></div>


        <!-- オススメスポット -->
        {% from "common.html" import spot %}
        {{ spot() }}

        <!-- モデルコース -->
        {% from "common.html" import model_course %}
        {{ model_course() }}

        <!-- 人気のコース -->
        {% from "common.html" import share_course %}
        {{ share_course() }}
    </div>
</div>

<!--jquery-->
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

<!--Google map api 開発用-->
<script src="https://maps.google.com/maps/api/js?v=3&key=AIzaSyBdfdAlLSf8hWn3cLczA7DFQOSzn3VuUCM"></script>

<!--Google map api 本番用-->
<!--<script src="https://maps.google.com/maps/api/js?v=3&key=AIzaSyC9akic1UAj-i4X1fWeYBZwFUkMv3MCNSk"></script>-->

<!-- LIFF SDK-->
<script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript" src="/static/js/main.js"></script>
<script>
    window.onload = function () {
        // init で初期化。基本情報を取得。
        liff.init(function (data) {

            getProfile();
        });
    }

    // プロファイルの取得と表示
    function getProfile() {
        liff.getProfile().then((profile) => {
            document.getElementById('login_name').textContent = 'ようこそ ' + profile.displayName + ' さん';
        }).catch(function (error) {
            window.alert("Error getting profile: " + error);
        });
    }
</script>
<script>
    function getMyPlace() {
        var output = document.getElementById("result");
        if (!navigator.geolocation) {//Geolocation apiがサポートされていない場合
            output.innerHTML = "<p>Geolocationはあなたのブラウザーでサポートされておりません</p>";
            return;
        }
        function success(position) {
            var latitude = position.coords.latitude;//緯度
            var longitude = position.coords.longitude;//経度
            output.innerHTML = '<p>緯度 ' + latitude + '° <br>経度 ' + longitude + '°</p>';
            // 位置情報
            var latlng = new google.maps.LatLng(latitude, longitude);
            // Google Mapsに書き出し
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,// ズーム値
                center: latlng,// 中心座標
            });
            // マーカーの新規出力
            new google.maps.Marker({
                map: map,
                position: latlng,
            });
        };
        function error() {
            //エラーの場合
            output.innerHTML = "座標位置を取得できません";
        };
        navigator.geolocation.getCurrentPosition(success, error);//成功と失敗を判断
    }
</script>
{% endblock %}
